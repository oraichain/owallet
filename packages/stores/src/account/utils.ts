import { AminoMsgsOrWithProtoMsgs } from './base';
import { EthermintChainIdHelper } from "@owallet/cosmos";
export const getEip712TypedDataBasedOnChainId = (
  chainId: string,
  msgs: AminoMsgsOrWithProtoMsgs
): {
  types: Record<string, { name: string; type: string }[] | undefined>;
  domain: Record<string, any>;
  primaryType: string;
} => {
  const chainIsInjective = chainId.startsWith('injective');
  const { ethChainId } = EthermintChainIdHelper.parse(chainId);

  const types = {
    types: {
      EIP712Domain: [
        { name: 'name', type: 'string' },
        { name: 'version', type: 'string' },
        { name: 'chainId', type: 'uint256' },
        // XXX: Maybe, non-standard format?
        { name: 'verifyingContract', type: 'string' },
        // XXX: Maybe, non-standard format?
        { name: 'salt', type: 'string' }
      ],
      Tx: [
        { name: 'account_number', type: 'string' },
        { name: 'chain_id', type: 'string' },
        { name: 'fee', type: 'Fee' },
        { name: 'memo', type: 'string' },
        { name: 'msgs', type: 'Msg[]' },
        { name: 'sequence', type: 'string' }
      ],
      Fee: [
        { name: 'feePayer', type: 'string' },
        { name: 'amount', type: 'Coin[]' },
        { name: 'gas', type: 'string' }
      ],
      Coin: [
        { name: 'denom', type: 'string' },
        { name: 'amount', type: 'string' }
      ],
      Msg: [
        { name: 'type', type: 'string' },
        { name: 'value', type: 'MsgValue' }
      ],
      ...msgs.rlpTypes,
    },
    domain: {
      name: 'Cosmos Web3',
      version: '1.0.0',
      chainId: ethChainId.toString(),
      verifyingContract: 'cosmos',
      salt: '0'
    },
    primaryType: 'Tx'
  };

  // Injective doesn't need feePayer to be included but requires
  // timeout_height in the types
  if (chainIsInjective) {
    types.types.Tx = [...types.types.Tx, { name: 'timeout_height', type: 'string' }];
    types.domain.name = 'Injective Web3';
    types.domain.chainId = '0x' + ethChainId.toString(16);
    types.types.Fee = [
      { name: 'amount', type: 'Coin[]' },
      { name: 'gas', type: 'string' }
    ];

    return types;
  }

  // Return default types for Evmos
  return types;
};
